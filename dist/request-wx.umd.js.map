{"version":3,"file":"request-wx.umd.js","sources":["../src/request-wx.ts"],"sourcesContent":["interface Response {\n  [key:string]:any,\n}\n\ninterface RequestConfigs {\n  header?: Record<string, string|number>,\n  successCondition?: (res:Response) => boolean,\n  isShowErrorMessage?: boolean,\n  commonParams?: Record<string, any>,\n  baseUrl?: string,\n  getErrorno?: (res:Response) => number | string,\n  getErrorMsg?: (res:Response) => string,\n}\n\ninterface RequestOptions {\n  requestHeaders?: Record<string, string|number>,\n  isShowLoading?: boolean,\n}\n\ntype RequestMethod = 'OPTIONS'|'GET'|'HEAD'|'POST'|'PUT'|'DELETE'|'TRACE'|'CONNECT';\n\nexport const NET_ERR_NO = -11;\nexport const SERVICE_ERR_NO = -10;\n\n/**\n * @param {*} type 请求的类型\n * @param {*} configs 请求的通用配置项\n * @param {*} url 请求的路由\n * @param {*} params 请求的参数\n */\nconst httpRequest = (wx: Record<string, any>, type:RequestMethod, configs?:RequestConfigs) => (url:string, params?:Record<string, any>, requestOptions?:RequestOptions) => {\n  const { \n    header = {}, \n    successCondition = (res:Response) =>  res && res.data && res.data.errno === 0,\n    isShowErrorMessage = true,\n    commonParams = {},\n    baseUrl = '',\n    getErrorno = (res:Response) => res && res.data && res.data.errno,\n    getErrorMsg = (res:Response) => res && res.data && res.data.errmsg,\n  } = configs || {};\n  const { requestHeaders = {}, isShowLoading = false } = requestOptions || {};\n  return new Promise((resolve, reject) => {\n    isShowLoading && wx.showLoading({ title: '加载中' });\n    wx.request({\n      url: `${baseUrl}${url}`,\n      method: type || 'GET',\n      data: Object.assign(commonParams, params || {}),\n      header: {\n        ...header,\n        ...requestHeaders,\n      },\n      success(res:Response) {\n        const errMessage:Record<string, string|number> = {};\n        if (successCondition(res)) {\n          // http code 200\n          resolve(res.data);  // 直接将服务器返回的数据抛出\n        } else {\n          errMessage.errno = getErrorno(res) || SERVICE_ERR_NO;\n          errMessage.errmsg = getErrorMsg(res) || '网络错误';\n          reject(errMessage);\n        } \n        if (errMessage.errmsg && isShowErrorMessage) {\n          wx.showToast({\n            title: errMessage.errmsg,\n            icon: 'none',\n          });\n        }\n      },\n      fail(err:{errMsg:string}) {\n        reject({errno: NET_ERR_NO, errmsg: err.errMsg});\n        isShowErrorMessage && wx.showToast({\n          title: '请求异常',\n          icon: 'none',\n        });\n      },\n      complete() {\n        isShowLoading && wx.hideLoading();\n      }\n    });\n  })\n};\n\nexport default httpRequest;\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;QAqBa,UAAU,GAAG,CAAC,EAAE,CAAC;AAC9B,QAAa,cAAc,GAAG,CAAC,EAAE,CAAC;IAElC;;;;;;IAMA,IAAM,WAAW,GAAG,UAAC,EAAuB,EAAE,IAAkB,EAAE,OAAuB,IAAK,OAAA,UAAC,GAAU,EAAE,MAA2B,EAAE,cAA8B;QAC9J,IAAA,KAQF,OAAO,IAAI,EAAE,EAPf,cAAW,EAAX,MAAM,mBAAG,EAAE,KAAA,EACX,wBAA6E,EAA7E,gBAAgB,mBAAG,UAAC,GAAY,IAAM,OAAA,GAAG,IAAI,GAAG,CAAC,IAAI,IAAI,GAAG,CAAC,IAAI,CAAC,KAAK,KAAK,CAAC,GAAA,KAAA,EAC7E,0BAAyB,EAAzB,kBAAkB,mBAAG,IAAI,KAAA,EACzB,oBAAiB,EAAjB,YAAY,mBAAG,EAAE,KAAA,EACjB,eAAY,EAAZ,OAAO,mBAAG,EAAE,KAAA,EACZ,kBAAgE,EAAhE,UAAU,mBAAG,UAAC,GAAY,IAAK,OAAA,GAAG,IAAI,GAAG,CAAC,IAAI,IAAI,GAAG,CAAC,IAAI,CAAC,KAAK,GAAA,KAAA,EAChE,mBAAkE,EAAlE,WAAW,mBAAG,UAAC,GAAY,IAAK,OAAA,GAAG,IAAI,GAAG,CAAC,IAAI,IAAI,GAAG,CAAC,IAAI,CAAC,MAAM,GAAA,KACnD,CAAC;QACZ,IAAA,KAAiD,cAAc,IAAI,EAAE,EAAnE,sBAAmB,EAAnB,cAAc,mBAAG,EAAE,KAAA,EAAE,qBAAqB,EAArB,aAAa,mBAAG,KAAK,KAAyB,CAAC;QAC5E,OAAO,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;YACjC,aAAa,IAAI,EAAE,CAAC,WAAW,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC,CAAC;YAClD,EAAE,CAAC,OAAO,CAAC;gBACT,GAAG,EAAE,KAAG,OAAO,GAAG,GAAK;gBACvB,MAAM,EAAE,IAAI,IAAI,KAAK;gBACrB,IAAI,EAAE,MAAM,CAAC,MAAM,CAAC,YAAY,EAAE,MAAM,IAAI,EAAE,CAAC;gBAC/C,MAAM,wBACD,MAAM,GACN,cAAc,CAClB;gBACD,OAAO,EAAP,UAAQ,GAAY;oBAClB,IAAM,UAAU,GAAiC,EAAE,CAAC;oBACpD,IAAI,gBAAgB,CAAC,GAAG,CAAC,EAAE;;wBAEzB,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;qBACnB;yBAAM;wBACL,UAAU,CAAC,KAAK,GAAG,UAAU,CAAC,GAAG,CAAC,IAAI,cAAc,CAAC;wBACrD,UAAU,CAAC,MAAM,GAAG,WAAW,CAAC,GAAG,CAAC,IAAI,MAAM,CAAC;wBAC/C,MAAM,CAAC,UAAU,CAAC,CAAC;qBACpB;oBACD,IAAI,UAAU,CAAC,MAAM,IAAI,kBAAkB,EAAE;wBAC3C,EAAE,CAAC,SAAS,CAAC;4BACX,KAAK,EAAE,UAAU,CAAC,MAAM;4BACxB,IAAI,EAAE,MAAM;yBACb,CAAC,CAAC;qBACJ;iBACF;gBACD,IAAI,EAAJ,UAAK,GAAmB;oBACtB,MAAM,CAAC,EAAC,KAAK,EAAE,UAAU,EAAE,MAAM,EAAE,GAAG,CAAC,MAAM,EAAC,CAAC,CAAC;oBAChD,kBAAkB,IAAI,EAAE,CAAC,SAAS,CAAC;wBACjC,KAAK,EAAE,MAAM;wBACb,IAAI,EAAE,MAAM;qBACb,CAAC,CAAC;iBACJ;gBACD,QAAQ;oBACN,aAAa,IAAI,EAAE,CAAC,WAAW,EAAE,CAAC;iBACnC;aACF,CAAC,CAAC;SACJ,CAAC,CAAA;IACJ,CAAC,GAAA,CAAC;;;;;;;;;;;;;;"}