{"version":3,"file":"request-wx.umd.js","sources":["../src/request-wx.ts"],"sourcesContent":["interface Response {\n  [key:string]:any,\n}\n\ninterface RequestConfigs {\n  header?: Record<string, string|number>,\n  successCondition?: (res:Response) => boolean,\n  isShowErrorMessage?: boolean,\n  commonParams?: Record<string, any>,\n  baseUrl?: string,\n  getErrorno?: (res:Response) => number | string,\n  getErrorMsg?: (res:Response) => string,\n}\n\ninterface RequestOptions {\n  requestHeaders?: Record<string, string|number>,\n  isShowLoading?: boolean,\n}\n\ntype RequestMethod = 'OPTIONS'|'GET'|'HEAD'|'POST'|'PUT'|'DELETE'|'TRACE'|'CONNECT';\n\n/**\n * @param {*} type 请求的类型\n * @param {*} configs 请求的通用配置项\n * @param {*} url 请求的路由\n * @param {*} params 请求的参数\n */\nconst httpRequest = (wx: Record<string, any>, type:RequestMethod, configs?:RequestConfigs) => (url:string, params?:Record<string, any>, requestOptions?:RequestOptions) => {\n  const { \n    header = {}, \n    successCondition = (res:Response) =>  res && res.data && res.data.errno === 0,\n    isShowErrorMessage = true,\n    commonParams = {},\n    baseUrl = '',\n    getErrorno = (res:Response) => res && res.data && res.data.errno,\n    getErrorMsg = (res:Response) => res && res.data && res.data.errmsg,\n  } = configs || {};\n  const { requestHeaders = {}, isShowLoading = false } = requestOptions || {};\n  return new Promise((resolve, reject) => {\n    isShowLoading && wx.showLoading({ title: '加载中' });\n    wx.request({\n      url: `${baseUrl}${url}`,\n      method: type || 'GET',\n      data: Object.assign(commonParams, params || {}),\n      header: {\n        ...header,\n        ...requestHeaders,\n      },\n      success(res:Response) {\n        const errMessage:Record<string, string|number> = {};\n        if (successCondition(res)) {\n          // http code 200\n          resolve(res.data);  // 直接将服务器返回的数据抛出\n        } else {\n          errMessage.errno = getErrorno(res) || -10;\n          errMessage.errmsg = getErrorMsg(res) || '网络错误';\n          reject(errMessage);\n        } \n        if (errMessage.errmsg && isShowErrorMessage) {\n          wx.showToast({\n            title: errMessage.errmsg,\n            icon: 'none',\n          });\n        }\n      },\n      fail(err:{errMsg:string}) {\n        reject({errno: -11, errmsg: err.errMsg});\n        isShowErrorMessage && wx.showToast({\n          title: '请求异常',\n          icon: 'none',\n        });\n      },\n      complete() {\n        isShowLoading && wx.hideLoading();\n      }\n    });\n  })\n};\n\nmodule.exports = httpRequest;\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;EAqBA;;;;;;EAMA,IAAM,WAAW,GAAG,UAAC,EAAuB,EAAE,IAAkB,EAAE,OAAuB,IAAK,OAAA,UAAC,GAAU,EAAE,MAA2B,EAAE,cAA8B;MAC9J,IAAA,KAQF,OAAO,IAAI,EAAE,EAPf,cAAW,EAAX,MAAM,mBAAG,EAAE,KAAA,EACX,wBAA6E,EAA7E,gBAAgB,mBAAG,UAAC,GAAY,IAAM,OAAA,GAAG,IAAI,GAAG,CAAC,IAAI,IAAI,GAAG,CAAC,IAAI,CAAC,KAAK,KAAK,CAAC,GAAA,KAAA,EAC7E,0BAAyB,EAAzB,kBAAkB,mBAAG,IAAI,KAAA,EACzB,oBAAiB,EAAjB,YAAY,mBAAG,EAAE,KAAA,EACjB,eAAY,EAAZ,OAAO,mBAAG,EAAE,KAAA,EACZ,kBAAgE,EAAhE,UAAU,mBAAG,UAAC,GAAY,IAAK,OAAA,GAAG,IAAI,GAAG,CAAC,IAAI,IAAI,GAAG,CAAC,IAAI,CAAC,KAAK,GAAA,KAAA,EAChE,mBAAkE,EAAlE,WAAW,mBAAG,UAAC,GAAY,IAAK,OAAA,GAAG,IAAI,GAAG,CAAC,IAAI,IAAI,GAAG,CAAC,IAAI,CAAC,MAAM,GAAA,KACnD,CAAC;MACZ,IAAA,KAAiD,cAAc,IAAI,EAAE,EAAnE,sBAAmB,EAAnB,cAAc,mBAAG,EAAE,KAAA,EAAE,qBAAqB,EAArB,aAAa,mBAAG,KAAK,KAAyB,CAAC;MAC5E,OAAO,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;UACjC,aAAa,IAAI,EAAE,CAAC,WAAW,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC,CAAC;UAClD,EAAE,CAAC,OAAO,CAAC;cACT,GAAG,EAAE,KAAG,OAAO,GAAG,GAAK;cACvB,MAAM,EAAE,IAAI,IAAI,KAAK;cACrB,IAAI,EAAE,MAAM,CAAC,MAAM,CAAC,YAAY,EAAE,MAAM,IAAI,EAAE,CAAC;cAC/C,MAAM,wBACD,MAAM,GACN,cAAc,CAClB;cACD,OAAO,EAAP,UAAQ,GAAY;kBAClB,IAAM,UAAU,GAAiC,EAAE,CAAC;kBACpD,IAAI,gBAAgB,CAAC,GAAG,CAAC,EAAE;;sBAEzB,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;mBACnB;uBAAM;sBACL,UAAU,CAAC,KAAK,GAAG,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC;sBAC1C,UAAU,CAAC,MAAM,GAAG,WAAW,CAAC,GAAG,CAAC,IAAI,MAAM,CAAC;sBAC/C,MAAM,CAAC,UAAU,CAAC,CAAC;mBACpB;kBACD,IAAI,UAAU,CAAC,MAAM,IAAI,kBAAkB,EAAE;sBAC3C,EAAE,CAAC,SAAS,CAAC;0BACX,KAAK,EAAE,UAAU,CAAC,MAAM;0BACxB,IAAI,EAAE,MAAM;uBACb,CAAC,CAAC;mBACJ;eACF;cACD,IAAI,EAAJ,UAAK,GAAmB;kBACtB,MAAM,CAAC,EAAC,KAAK,EAAE,CAAC,EAAE,EAAE,MAAM,EAAE,GAAG,CAAC,MAAM,EAAC,CAAC,CAAC;kBACzC,kBAAkB,IAAI,EAAE,CAAC,SAAS,CAAC;sBACjC,KAAK,EAAE,MAAM;sBACb,IAAI,EAAE,MAAM;mBACb,CAAC,CAAC;eACJ;cACD,QAAQ;kBACN,aAAa,IAAI,EAAE,CAAC,WAAW,EAAE,CAAC;eACnC;WACF,CAAC,CAAC;OACJ,CAAC,CAAA;EACJ,CAAC,GAAA,CAAC;EAEF,MAAM,CAAC,OAAO,GAAG,WAAW,CAAC;;;;"}